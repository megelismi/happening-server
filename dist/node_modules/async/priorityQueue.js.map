{"version":3,"sources":["../../../node_modules/async/priorityQueue.js"],"names":["Object","defineProperty","exports","value","default","worker","concurrency","q","_queue2","push","data","priority","callback","_noop2","Error","started","_isArray2","length","_setImmediate2","drain","nextNode","_tasks","head","next","i","l","item","insertBefore","process","unshift","_isArray","require","_interopRequireDefault","_noop","_setImmediate","_queue","obj","__esModule","module"],"mappings":"AAAA;;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AACzCC,WAAO;AADkC,CAA7C;;AAIAD,QAAQE,OAAR,GAAkB,UAAUC,MAAV,EAAkBC,WAAlB,EAA+B;AAC7C;AACA,QAAIC,IAAI,CAAC,GAAGC,QAAQJ,OAAZ,EAAqBC,MAArB,EAA6BC,WAA7B,CAAR;;AAEA;AACAC,MAAEE,IAAF,GAAS,UAAUC,IAAV,EAAgBC,QAAhB,EAA0BC,QAA1B,EAAoC;AACzC,YAAIA,YAAY,IAAhB,EAAsBA,WAAWC,OAAOT,OAAlB;AACtB,YAAI,OAAOQ,QAAP,KAAoB,UAAxB,EAAoC;AAChC,kBAAM,IAAIE,KAAJ,CAAU,kCAAV,CAAN;AACH;AACDP,UAAEQ,OAAF,GAAY,IAAZ;AACA,YAAI,CAAC,CAAC,GAAGC,UAAUZ,OAAd,EAAuBM,IAAvB,CAAL,EAAmC;AAC/BA,mBAAO,CAACA,IAAD,CAAP;AACH;AACD,YAAIA,KAAKO,MAAL,KAAgB,CAApB,EAAuB;AACnB;AACA,mBAAO,CAAC,GAAGC,eAAed,OAAnB,EAA4B,YAAY;AAC3CG,kBAAEY,KAAF;AACH,aAFM,CAAP;AAGH;;AAEDR,mBAAWA,YAAY,CAAvB;AACA,YAAIS,WAAWb,EAAEc,MAAF,CAASC,IAAxB;AACA,eAAOF,YAAYT,YAAYS,SAAST,QAAxC,EAAkD;AAC9CS,uBAAWA,SAASG,IAApB;AACH;;AAED,aAAK,IAAIC,IAAI,CAAR,EAAWC,IAAIf,KAAKO,MAAzB,EAAiCO,IAAIC,CAArC,EAAwCD,GAAxC,EAA6C;AACzC,gBAAIE,OAAO;AACPhB,sBAAMA,KAAKc,CAAL,CADC;AAEPb,0BAAUA,QAFH;AAGPC,0BAAUA;AAHH,aAAX;;AAMA,gBAAIQ,QAAJ,EAAc;AACVb,kBAAEc,MAAF,CAASM,YAAT,CAAsBP,QAAtB,EAAgCM,IAAhC;AACH,aAFD,MAEO;AACHnB,kBAAEc,MAAF,CAASZ,IAAT,CAAciB,IAAd;AACH;AACJ;AACD,SAAC,GAAGR,eAAed,OAAnB,EAA4BG,EAAEqB,OAA9B;AACH,KApCD;;AAsCA;AACA,WAAOrB,EAAEsB,OAAT;;AAEA,WAAOtB,CAAP;AACH,CA/CD;;AAiDA,IAAIuB,WAAWC,QAAQ,gBAAR,CAAf;;AAEA,IAAIf,YAAYgB,uBAAuBF,QAAvB,CAAhB;;AAEA,IAAIG,QAAQF,QAAQ,aAAR,CAAZ;;AAEA,IAAIlB,SAASmB,uBAAuBC,KAAvB,CAAb;;AAEA,IAAIC,gBAAgBH,QAAQ,gBAAR,CAApB;;AAEA,IAAIb,iBAAiBc,uBAAuBE,aAAvB,CAArB;;AAEA,IAAIC,SAASJ,QAAQ,SAAR,CAAb;;AAEA,IAAIvB,UAAUwB,uBAAuBG,MAAvB,CAAd;;AAEA,SAASH,sBAAT,CAAgCI,GAAhC,EAAqC;AAAE,WAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAEhC,SAASgC,GAAX,EAArC;AAAwD;;AAE/FE,OAAOpC,OAAP,GAAiBA,QAAQ,SAAR,CAAjB;;AAEA","file":"priorityQueue.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nexports.default = function (worker, concurrency) {\n    // Start with a normal queue\n    var q = (0, _queue2.default)(worker, concurrency);\n\n    // Override push to accept second parameter representing priority\n    q.push = function (data, priority, callback) {\n        if (callback == null) callback = _noop2.default;\n        if (typeof callback !== 'function') {\n            throw new Error('task callback must be a function');\n        }\n        q.started = true;\n        if (!(0, _isArray2.default)(data)) {\n            data = [data];\n        }\n        if (data.length === 0) {\n            // call drain immediately if there are no tasks\n            return (0, _setImmediate2.default)(function () {\n                q.drain();\n            });\n        }\n\n        priority = priority || 0;\n        var nextNode = q._tasks.head;\n        while (nextNode && priority >= nextNode.priority) {\n            nextNode = nextNode.next;\n        }\n\n        for (var i = 0, l = data.length; i < l; i++) {\n            var item = {\n                data: data[i],\n                priority: priority,\n                callback: callback\n            };\n\n            if (nextNode) {\n                q._tasks.insertBefore(nextNode, item);\n            } else {\n                q._tasks.push(item);\n            }\n        }\n        (0, _setImmediate2.default)(q.process);\n    };\n\n    // Remove unshift function\n    delete q.unshift;\n\n    return q;\n};\n\nvar _isArray = require('lodash/isArray');\n\nvar _isArray2 = _interopRequireDefault(_isArray);\n\nvar _noop = require('lodash/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _setImmediate = require('./setImmediate');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _queue = require('./queue');\n\nvar _queue2 = _interopRequireDefault(_queue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = exports['default'];\n\n/**\n * The same as [async.queue]{@link module:ControlFlow.queue} only tasks are assigned a priority and\n * completed in ascending priority order.\n *\n * @name priorityQueue\n * @static\n * @memberOf module:ControlFlow\n * @method\n * @see [async.queue]{@link module:ControlFlow.queue}\n * @category Control Flow\n * @param {Function} worker - An asynchronous function for processing a queued\n * task, which must call its `callback(err)` argument when finished, with an\n * optional `error` as an argument.  If you want to handle errors from an\n * individual task, pass a callback to `q.push()`. Invoked with\n * (task, callback).\n * @param {number} concurrency - An `integer` for determining how many `worker`\n * functions should be run in parallel.  If omitted, the concurrency defaults to\n * `1`.  If the concurrency is `0`, an error is thrown.\n * @returns {module:ControlFlow.QueueObject} A priorityQueue object to manage the tasks. There are two\n * differences between `queue` and `priorityQueue` objects:\n * * `push(task, priority, [callback])` - `priority` should be a number. If an\n *   array of `tasks` is given, all tasks will be assigned the same priority.\n * * The `unshift` method was removed.\n */"]}