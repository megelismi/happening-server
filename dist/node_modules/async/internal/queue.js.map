{"version":3,"sources":["../../../../node_modules/async/internal/queue.js"],"names":["Object","defineProperty","exports","value","default","queue","_baseIndexOf","require","_baseIndexOf2","_interopRequireDefault","_isArray","_isArray2","_noop","_noop2","_rest","_rest2","_onlyOnce","_onlyOnce2","_setImmediate","_setImmediate2","_DoublyLinkedList","_DoublyLinkedList2","obj","__esModule","worker","concurrency","payload","Error","_insert","data","insertAtFront","callback","q","started","length","idle","drain","i","l","item","_tasks","unshift","push","process","_next","tasks","args","workers","task","index","workersList","splice","apply","error","buffer","unsaturated","saturated","empty","paused","kill","Math","min","node","shift","cb","running","pause","resume","resumeCount","w","module"],"mappings":"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","file":"queue.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = queue;\n\nvar _baseIndexOf = require('lodash/_baseIndexOf');\n\nvar _baseIndexOf2 = _interopRequireDefault(_baseIndexOf);\n\nvar _isArray = require('lodash/isArray');\n\nvar _isArray2 = _interopRequireDefault(_isArray);\n\nvar _noop = require('lodash/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _rest = require('./rest');\n\nvar _rest2 = _interopRequireDefault(_rest);\n\nvar _onlyOnce = require('./onlyOnce');\n\nvar _onlyOnce2 = _interopRequireDefault(_onlyOnce);\n\nvar _setImmediate = require('./setImmediate');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _DoublyLinkedList = require('./DoublyLinkedList');\n\nvar _DoublyLinkedList2 = _interopRequireDefault(_DoublyLinkedList);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction queue(worker, concurrency, payload) {\n    if (concurrency == null) {\n        concurrency = 1;\n    } else if (concurrency === 0) {\n        throw new Error('Concurrency must not be zero');\n    }\n\n    function _insert(data, insertAtFront, callback) {\n        if (callback != null && typeof callback !== 'function') {\n            throw new Error('task callback must be a function');\n        }\n        q.started = true;\n        if (!(0, _isArray2.default)(data)) {\n            data = [data];\n        }\n        if (data.length === 0 && q.idle()) {\n            // call drain immediately if there are no tasks\n            return (0, _setImmediate2.default)(function () {\n                q.drain();\n            });\n        }\n\n        for (var i = 0, l = data.length; i < l; i++) {\n            var item = {\n                data: data[i],\n                callback: callback || _noop2.default\n            };\n\n            if (insertAtFront) {\n                q._tasks.unshift(item);\n            } else {\n                q._tasks.push(item);\n            }\n        }\n        (0, _setImmediate2.default)(q.process);\n    }\n\n    function _next(tasks) {\n        return (0, _rest2.default)(function (args) {\n            workers -= 1;\n\n            for (var i = 0, l = tasks.length; i < l; i++) {\n                var task = tasks[i];\n                var index = (0, _baseIndexOf2.default)(workersList, task, 0);\n                if (index >= 0) {\n                    workersList.splice(index);\n                }\n\n                task.callback.apply(task, args);\n\n                if (args[0] != null) {\n                    q.error(args[0], task.data);\n                }\n            }\n\n            if (workers <= q.concurrency - q.buffer) {\n                q.unsaturated();\n            }\n\n            if (q.idle()) {\n                q.drain();\n            }\n            q.process();\n        });\n    }\n\n    var workers = 0;\n    var workersList = [];\n    var q = {\n        _tasks: new _DoublyLinkedList2.default(),\n        concurrency: concurrency,\n        payload: payload,\n        saturated: _noop2.default,\n        unsaturated: _noop2.default,\n        buffer: concurrency / 4,\n        empty: _noop2.default,\n        drain: _noop2.default,\n        error: _noop2.default,\n        started: false,\n        paused: false,\n        push: function (data, callback) {\n            _insert(data, false, callback);\n        },\n        kill: function () {\n            q.drain = _noop2.default;\n            q._tasks.empty();\n        },\n        unshift: function (data, callback) {\n            _insert(data, true, callback);\n        },\n        process: function () {\n            while (!q.paused && workers < q.concurrency && q._tasks.length) {\n                var tasks = [],\n                    data = [];\n                var l = q._tasks.length;\n                if (q.payload) l = Math.min(l, q.payload);\n                for (var i = 0; i < l; i++) {\n                    var node = q._tasks.shift();\n                    tasks.push(node);\n                    data.push(node.data);\n                }\n\n                if (q._tasks.length === 0) {\n                    q.empty();\n                }\n                workers += 1;\n                workersList.push(tasks[0]);\n\n                if (workers === q.concurrency) {\n                    q.saturated();\n                }\n\n                var cb = (0, _onlyOnce2.default)(_next(tasks));\n                worker(data, cb);\n            }\n        },\n        length: function () {\n            return q._tasks.length;\n        },\n        running: function () {\n            return workers;\n        },\n        workersList: function () {\n            return workersList;\n        },\n        idle: function () {\n            return q._tasks.length + workers === 0;\n        },\n        pause: function () {\n            q.paused = true;\n        },\n        resume: function () {\n            if (q.paused === false) {\n                return;\n            }\n            q.paused = false;\n            var resumeCount = Math.min(q.concurrency, q._tasks.length);\n            // Need to call q.process once per concurrent\n            // worker to preserve full concurrency after pause\n            for (var w = 1; w <= resumeCount; w++) {\n                (0, _setImmediate2.default)(q.process);\n            }\n        }\n    };\n    return q;\n}\nmodule.exports = exports['default'];"]}